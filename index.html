<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Pockethotline by chap</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Pockethotline</h1>
        <h2>Community Powered Hotlines</h2>
        <a href="https://github.com/chap/pockethotline" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a name="what" class="anchor" href="#what"><span class="octicon octicon-link"></span></a>What</h1>

<p>Pockethotline is a rails app that allows you to setup a "distributed hotline". This allows you to have a hotline number that is published and operators signup with their personal numbers. When someone calls the main number the operators will be called (depending on their on-call status) and connected to the main caller.</p>

<p>It was originally conceived as a business by Scott McGee and Chap Ambrose at the Austin Center for Design in the winter of 2011.</p>

<p>The software was open-sourced January 2014.</p>

<h1>
<a name="how-much-does-it-cost-to-run-a-hotline" class="anchor" href="#how-much-does-it-cost-to-run-a-hotline"><span class="octicon octicon-link"></span></a>How much does it cost to run a hotline?</h1>

<h4>
<a name="hosting-costs" class="anchor" href="#hosting-costs"><span class="octicon octicon-link"></span></a>Hosting Costs</h4>

<p>The minimum hosting costs are about $35 a month. This is because a background worker dyno is required. (Assuming you're using <a href="http://heroku.com">Heroku</a> for hosting).</p>

<h4>
<a name="phone-costs" class="anchor" href="#phone-costs"><span class="octicon octicon-link"></span></a>Phone Costs</h4>

<p><a href="http://twilio.com">Twilio</a> phone numbers cost $1/month for local numbers and $2/month for toll-free.</p>

<p>Twilio charges you by minutes used, $0.03/minute for local and $0.05/minute for toll-free. </p>

<p><em>Twilio's published rates are $0.01 / $0.03 but that is only for the incoming call, you also have to add another $0.02 to each call because of the outgoing connection to the operators.</em></p>

<h1>
<a name="basic-setup" class="anchor" href="#basic-setup"><span class="octicon octicon-link"></span></a>Basic Setup</h1>

<h2>
<a name="1-setup-accounts-on" class="anchor" href="#1-setup-accounts-on"><span class="octicon octicon-link"></span></a>1. Setup accounts on:</h2>

<ul>
<li><a href="http://twilio.com">Twilio.com</a></li>
<li>
<a href="http://heroku.com">Heroku.com</a> (or other rails capable host)</li>
</ul><h2>
<a name="2-get-a-phone-number-on-twilio" class="anchor" href="#2-get-a-phone-number-on-twilio"><span class="octicon octicon-link"></span></a>2. Get a phone number on Twilio</h2>

<p>Start with the free trial number or purchase another toll-free or local number.</p>

<h2>
<a name="3-take-note-of-your-phone-number-and-api-credentials-accountsid-and-authtoken" class="anchor" href="#3-take-note-of-your-phone-number-and-api-credentials-accountsid-and-authtoken"><span class="octicon octicon-link"></span></a>3. Take note of your phone number and API credentials AccountSID and AuthToken</h2>

<p>Find them under "Account Settings"</p>

<h2>
<a name="4-clone-the-repository" class="anchor" href="#4-clone-the-repository"><span class="octicon octicon-link"></span></a>4. Clone the repository</h2>

<p><code>$ git clone git@github.com:chap/pockethotline.git</code></p>

<h2>
<a name="5-edit-config-file-at-configinitializershotlinerb" class="anchor" href="#5-edit-config-file-at-configinitializershotlinerb"><span class="octicon octicon-link"></span></a>5. Edit config file at <code>/config/initializers/hotline.rb</code>
</h2>

<p>You must edit values for:</p>

<ul>
<li>config.x.hotline.name</li>
<li>config.x.hotline.domain</li>
<li>config.x.hotline.organizer</li>
<li>config.x.hotline.organizer_email </li>
<li>config.x.hotline.number</li>
</ul><h2>
<a name="6-save-changes" class="anchor" href="#6-save-changes"><span class="octicon octicon-link"></span></a>6. Save changes</h2>

<p><code>$ git commit config/initializers/hotline.rb -m "updated config"</code></p>

<h2>
<a name="7-create-an-app-on-heroku" class="anchor" href="#7-create-an-app-on-heroku"><span class="octicon octicon-link"></span></a>7. Create an app on heroku</h2>

<p><code>$ heroku create myhotline-name</code></p>

<h2>
<a name="8-enable-sendgrid-add-on-for-sending-email" class="anchor" href="#8-enable-sendgrid-add-on-for-sending-email"><span class="octicon octicon-link"></span></a>8. Enable Sendgrid add-on for sending email</h2>

<p><code>$ heroku addons:add sendgrid</code></p>

<p>Any SMTP provider should work. If you don't use Sendgrid, manually update settings at <code>config/initializers/smtp_settings.rb</code></p>

<h2>
<a name="9-push-application-to-heroku" class="anchor" href="#9-push-application-to-heroku"><span class="octicon octicon-link"></span></a>9. Push application to heroku</h2>

<p><code>$ git push heroku master</code></p>

<h2>
<a name="10-create-database-tables" class="anchor" href="#10-create-database-tables"><span class="octicon octicon-link"></span></a>10. Create database tables</h2>

<p><code>$ heroku run rake db:schema:load</code></p>

<h2>
<a name="11-scale-up-worker-dyno-required-for-background-tasks" class="anchor" href="#11-scale-up-worker-dyno-required-for-background-tasks"><span class="octicon octicon-link"></span></a>11. Scale up worker dyno (required for background tasks)</h2>

<p><code>$ heroku ps:scale worker=1</code></p>

<h2>
<a name="12-add-twilio_auth_token-env-variable-to-heroku-config" class="anchor" href="#12-add-twilio_auth_token-env-variable-to-heroku-config"><span class="octicon octicon-link"></span></a>12. Add TWILIO_AUTH_TOKEN ENV variable to heroku config</h2>

<p>Use Twilio API credentials from step 3.
<code>$ heroku config:set TWILIO_AUTH_TOKEN=XXXXXXXXXXXXXX</code></p>

<h2>
<a name="13-add-session_secret-env-variables-to-heroku-config" class="anchor" href="#13-add-session_secret-env-variables-to-heroku-config"><span class="octicon octicon-link"></span></a>13. Add SESSION_SECRET ENV variables to heroku config</h2>

<p>First run<br><code>$ heroku run rake secret</code></p>

<p>Copy the output and use it here:<br><code>$ heroku config:set SESSION_SECRET=XXXXXXXXXXXXXX</code></p>

<h2>
<a name="13-create-yourself-an-account-edit-these-values" class="anchor" href="#13-create-yourself-an-account-edit-these-values"><span class="octicon octicon-link"></span></a>13. Create yourself an account (edit these values)</h2>

<pre><code>  $ heroku run rails console
  $ u = User.new(
    :name =&gt; 'my name', 
    :email =&gt; 'myemail@email.com', 
    :phone =&gt; '215-359-5228', 
    :password =&gt; 'setyourpasswordhere'
    )
    u.admin = true
    u.on_call = true
    u.save!
</code></pre>

<h2>
<a name="14-login-to-your-account" class="anchor" href="#14-login-to-your-account"><span class="octicon octicon-link"></span></a>14. Login to your account</h2>

<p><code>$ heroku open</code></p>

<h2>
<a name="15-update-twilio-with-your-apps-domain" class="anchor" href="#15-update-twilio-with-your-apps-domain"><span class="octicon octicon-link"></span></a>15. Update Twilio with your app's domain</h2>

<ul>
<li>Click on 'Numbers' in the nav bar</li>
<li>Click on your phone number</li>
<li>Change the 'Voice Request URL' to <code>https://myhotline-name.herokuapp.com/twilio/start</code>
</li>
<li>Set request method to [POST]</li>
</ul><h2>
<a name="16-call-the-hotline-and-see-if-its-working" class="anchor" href="#16-call-the-hotline-and-see-if-its-working"><span class="octicon octicon-link"></span></a>16. Call the hotline and see if it's working!</h2>

<ul>
<li>Don't call from the same number that you added for yourself</li>
<li>If you're using your free demo Twilio account you'll hear a pre-roll message. That will go away when you upgrade your account.</li>
<li>Your call should be connected after the greeting message is used.</li>
<li>If calling via Gtalk fails to connect, try a real land or cell line.</li>
</ul><h2>
<a name="17-yeah" class="anchor" href="#17-yeah"><span class="octicon octicon-link"></span></a>17. Yeah!</h2>

<h1></h1>

<h1>
<a name="advanced-setup-of-hotline-supporters" class="anchor" href="#advanced-setup-of-hotline-supporters"><span class="octicon octicon-link"></span></a>Advanced Setup of Hotline Supporters</h1>

<h2>
<a name="1-create-an-account-on-stripecom" class="anchor" href="#1-create-an-account-on-stripecom"><span class="octicon octicon-link"></span></a>1. Create an account on Stripe.com</h2>

<h2>
<a name="2-set-stripe-publishable-key-in-config" class="anchor" href="#2-set-stripe-publishable-key-in-config"><span class="octicon octicon-link"></span></a>2. Set Stripe publishable key in config</h2>

<p>Uncomment (remove leading '#') and edit values in  <code>/config/hotline.rb</code></p>

<ul>
<li>config.x.stripe.publishable_key</li>
</ul><h2>
<a name="3-add-stripe-api-key" class="anchor" href="#3-add-stripe-api-key"><span class="octicon octicon-link"></span></a>3. Add Stripe API key</h2>

<p><code>$ heroku config:set STRIPE_SECRET_KEY=XXXXXXXXXXXXXX</code></p>

<h2>
<a name="4-save-changes-and-deploy" class="anchor" href="#4-save-changes-and-deploy"><span class="octicon octicon-link"></span></a>4. Save changes and deploy</h2>

<p><code>$ git commit /config/initializers/hotline.rb -m "add stripe details"</code>
<code>$ git push heroku</code></p>

<h2>
<a name="5-visit-suporters-page" class="anchor" href="#5-visit-suporters-page"><span class="octicon octicon-link"></span></a>5. Visit suporters page</h2>

<p>https://.../supporters/new  </p>

<p>Stripe requires SSL to be enabled, if you're using your default heroku domain you will seemlessly piggy-back on the wildcard certificate at *.herokuapp.com.</p>

<p>If you want to use a different domain you may have to purchase and setup your own certificate. </p>

<h1></h1>

<h1>
<a name="advanced-allow-supporters-to-upload-images" class="anchor" href="#advanced-allow-supporters-to-upload-images"><span class="octicon octicon-link"></span></a>Advanced Allow Supporters to Upload Images</h1>

<h2>
<a name="1-add-your-s3-bucket-name-to-confighotlinerb" class="anchor" href="#1-add-your-s3-bucket-name-to-confighotlinerb"><span class="octicon octicon-link"></span></a>1. Add your S3 bucket name to /config/hotline.rb</h2>

<h2>
<a name="2-add-s3-access_key_id-and-secret_access_key" class="anchor" href="#2-add-s3-access_key_id-and-secret_access_key"><span class="octicon octicon-link"></span></a>2. Add S3 access_key_id and secret_access_key</h2>

<p><code>$ heroku config:set S3_ACCESS_KEY_ID=XXXXXXXXXXXXXX S3_SECRET_ACCESS_KEY=XXXXXXXXXXXXXX</code></p>

<h1></h1>

<h1>
<a name="forward-unanswered-calls-change-recordings-twitter-integration-etc" class="anchor" href="#forward-unanswered-calls-change-recordings-twitter-integration-etc"><span class="octicon octicon-link"></span></a>Forward unanswered calls, change recordings, Twitter integration, etc</h1>

<p>Look at all the options in /config/hotline.rb</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/chap/pockethotline/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/chap/pockethotline/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/chap/pockethotline"></a> is maintained by <a href="https://github.com/chap">chap</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>